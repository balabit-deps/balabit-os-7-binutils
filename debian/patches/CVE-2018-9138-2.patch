From 69799d67e8872dcd3feee81ed2ff0fc47beb52d7 Mon Sep 17 00:00:00 2001
From: Nick Clifton <nickc@redhat.com>
Date: Tue, 11 Dec 2018 12:01:15 +0000
Subject: [PATCH] Fix a failure in the libiberty testsuite by increasing the
 recursion limit to 2048.

	PR 88409
include	* demangle.h (DEMANGLE_RECURSION_LIMIT): Increase to 2048.

binutils* NEWS: Note that recursion limit has increased to 2048.
	* doc/binutils.texi: Likewise.
---
 binutils/ChangeLog         | 5 +++++
 binutils/NEWS              | 2 +-
 binutils/doc/binutils.texi | 8 ++++----
 include/ChangeLog          | 5 +++++
 include/demangle.h         | 2 +-
 5 files changed, 16 insertions(+), 6 deletions(-)

#diff --git a/binutils/ChangeLog b/binutils/ChangeLog
#index a5796a8cf90..a1fce1adc58 100644
#--- a/binutils/ChangeLog
#+++ b/binutils/ChangeLog
#@@ -1,3 +1,8 @@
#+2018-12-11  Nick Clifton  <nickc@redhat.com>
#+
#+	* NEWS: Note that recursion limit has increased to 2048.
#+	* doc/binutils.texi: Likewise.
#+
# 2018-12-08  Alan Modra  <amodra@gmail.com>
# 
# 	* strings.c (unget_part_char): New function.
#diff --git a/binutils/NEWS b/binutils/NEWS
#index ce9253411ac..6afa19db809 100644
#--- a/binutils/NEWS
#+++ b/binutils/NEWS
#@@ -4,7 +4,7 @@
#   maximum amount of recursion that is allowed whilst demangling strings.
#   The value for this limit is defined by the DEMANGLE_RECRUSE_LIMIT
#   constant declared in the include/demangle.h header file.  At the time
#-  of writing this constant has the value of 1024.
#+  of writing this constant has the value of 2048.
# 
#   The --no-recurse-limit option can be used to remove the limit, restoring
#   the behaviour of earlier versions of these tools.  This may be needed in
--- a/binutils/doc/binutils.texi
+++ b/binutils/doc/binutils.texi
@@ -949,7 +949,7 @@ whilst demangling strings.  Since the na
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
@@ -2193,7 +2193,7 @@ whilst demangling strings.  Since the na
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
@@ -3537,7 +3537,7 @@ whilst demangling strings.  Since the na
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
@@ -3760,7 +3760,7 @@ whilst demangling strings.  Since the na
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
--- a/include/demangle.h
+++ b/include/demangle.h
@@ -77,7 +77,7 @@ extern "C" {
 /* If DMGL_NO_RECURSE_LIMIT is not enabled, then this is the value used as
    the maximum depth of recursion allowed.  It should be enough for any
    real-world mangled name.  */
-#define DEMANGLE_RECURSION_LIMIT 1024
+#define DEMANGLE_RECURSION_LIMIT 2048
   
 /* Enumeration of possible demangling styles.
 
