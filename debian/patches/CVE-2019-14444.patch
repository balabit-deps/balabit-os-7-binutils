From e17869db99195849826eaaf5d2d0eb2cfdd7a2a7 Mon Sep 17 00:00:00 2001
From: Nick Clifton <nickc@redhat.com>
Date: Mon, 5 Aug 2019 10:40:35 +0100
Subject: [PATCH] Catch potential integer overflow in readelf when processing
 corrupt binaries.

	PR 24829
	* readelf.c (apply_relocations): Catch potential integer overflow
	whilst checking reloc location against section size.
---
 binutils/ChangeLog | 6 ++++++
 binutils/readelf.c | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

#diff --git a/binutils/ChangeLog b/binutils/ChangeLog
#index f3dc48c85df..22a7828d9c9 100644
#--- a/binutils/ChangeLog
#+++ b/binutils/ChangeLog
#@@ -1,3 +1,9 @@
#+2019-08-05  Nick Clifton  <nickc@redhat.com>
#+
#+	PR 24829
#+	* readelf.c (apply_relocations): Catch potential integer overflow
#+	whilst checking reloc location against section size.
#+
# 2019-08-02  Alan Modra  <amodra@gmail.com>
# 
# 	PR 24871
--- a/binutils/readelf.c
+++ b/binutils/readelf.c
@@ -12960,7 +12960,7 @@ apply_relocations (Filedata *
 	    }
 
 	  rloc = start + rp->r_offset;
-	  if ((rloc + reloc_size) > end || (rloc < start))
+	  if (rloc >= end || (rloc + reloc_size) > end || (rloc < start))
 	    {
 	      warn (_("skipping invalid relocation offset 0x%lx in section %s\n"),
 		    (unsigned long) rp->r_offset,
